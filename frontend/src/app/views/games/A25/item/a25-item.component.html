@if (error) {
  <Error [errorCode]="error"></Error>
}
@if (data; as item) {
  @if (showNav && item.material) {
    <Breadcrumb  [breadcrumbs]="[[gameTitle, '/'+gameURL], ['Materials', '/'+gameURL+'/items/materials/'+language]]" [current]="item.name"></Breadcrumb>
  }
  @if (showNav && !item.material) {
    <Breadcrumb [breadcrumbs]="[[gameTitle, '/'+gameURL], ['Synthesis Items', '/'+gameURL+'/items/synthesis/'+language]]" [current]="item.name"></Breadcrumb>
  }
  <div class="mx-auto row spacer">
    <div class="{{colset}} card card-body" style="{{insertStyle(item)}}">
      <h4 class="card-title card-icon-space">
        {{item.name}}
      </h4>
      <div class="card-icon-position">
        @if (item.material) {
          @if (item.material[0].traits) {
            <img loading="lazy" style="height:3rem;width:3rem;" src="{{imgURL}}svg/{{item.material[0].traits[0].kind}}.svg" alt="{{item.material[0].traits[0].kind}}">
          }
        }
        @if (item.combat) {
          <img style="height:3rem;width:3rem;" src="{{imgURL}}svg/{{item.combat[0].kind}}.svg" alt="{{item.combat[0].kind}}">
        }
        @if (item.equip) {
          <img  style="height:3rem;width:3rem;" src="{{imgURL}}svg/{{item.equip[0].kind}}.svg"  alt="{{item.equip[0].kind}}">
        }
      </div>
      <img loading="lazy" class="resleri-item-frame" height="256" width="256"
        style="background-image:url({{imgURL}}svg/item-frame-{{item.rarity}}.svg)"
        src="{{imgURL}}items/{{item.slug}}.webp" alt="{{item.name}}">
        @if (item.limit) {
          <p><b>Event: </b>{{item.limit}}</p>
        }
        @if (language == 'en' && !item.gbl) {
          <p>This item is not in Global yet. Displaying Japanese text.</p>
        }
        @if (item.desc) {
          <p [innerHTML]="item.desc"></p>
        }
        @if (item.recipe) {
          <div style="margin:auto;display:flex;padding-bottom:1rem;">
            <i style="font-size:100px;color:{{a25service.colors[item.recipe[0].colors[0]]}};display:inline;" class="atelier atelier-np atelier-resleri-color-l"></i>
            <i style="font-size:100px;color:{{a25service.colors[item.recipe[0].colors[1]]}};display:inline;" class="atelier atelier-np atelier-resleri-color-r"></i>
            <i style="font-size:100px;color:{{a25service.colors[item.recipe[0].colors[2]]}};display:inline;margin-left:-100px" class="atelier atelier-np atelier-resleri-color-bl"></i>
            <i style="font-size:100px;color:{{a25service.colors[item.recipe[0].colors[2]]}};display:inline;" class="atelier atelier-np atelier-resleri-color-br"></i>
          </div>
        }
        @if (item.material) {
          @if (item.note) {
            <p [innerHTML]="item.note"></p>
          }
          @if (item.material[0].traits) {
            <ul>
              @for (trait of item.material[0].traits; track trait) {
                <li>
                  <ng-template #traitPopover>
                    <p [innerHTML]="trait.desc.replaceAll('{0}', trait.val1 + ' ~ ' + trait.val5).replaceAll('{1}', trait.val1 + ' ~ ' + trait.val5)">{{trait.desc}}</p>
                    <a routerLink="/{{gameURL}}/traits/{{trait.slug}}/{{language}}">More info...</a>
                  </ng-template>
                  <a [popover]="traitPopover"
                    [popoverTitle]="trait.name"
                    (click)="$event.preventDefault();"
                  href="/{{gameURL}}/traits/{{trait.slug}}/{{language}}">{{trait.name}}</a>
                </li>
              }
            </ul>
          }
          @if (item.quest && item.material[0].traits) {
            <b>Locations:</b>
          }
          <ul>
            @for (quest of item.quest; track quest) {
              @if (quest.dungeon) {
                <li>
                  <a routerLink="/{{gameURL}}/quests/dungeons/{{language}}"
                    fragment="{{quest.dungeon[0].name}}">
                  {{quest.dungeon[0].name}}
                </a>
              </li>
            }
            @if (quest.scorebattle) {
              <li>
                Score Battle:
                <a routerLink="/{{gameURL}}/quests/scorebattles/{{language}}"
                  fragment="{{quest.scorebattle[0].scorebattle[0].chapter}}-{{quest.scorebattle[0].scorebattle[0].section}}">
                  {{quest.scorebattle[0].scorebattle[0].chapter}}-{{quest.scorebattle[0].scorebattle[0].section}} {{difficulties[quest.scorebattle[0].difficulty]}}
                </a>
              </li>
            }
          }
        </ul>
      }
      @if (item.combat) {
        @if (item.note) {
          <p [innerHTML]="item.note"></p>
        }
        <p><b>Uses:</b> {{item.combat[0].uses}}<br />
        <b>Range:</b> {{item.combat[0].area}}</p>
      }
      @if (item.equip) {
        @if (item.note) {
          <p [innerHTML]="item.note"></p>
        }
        <table class="tbl"><tbody>
          <tr class="table-dark-center"><th colspan="4">Stats</th></tr>
          <tr>
            <td style="width:25%;">{{a25service.stats['hp'][language]}} </td>
            <td style="width:25%;">@if (item.equip[0].bad_hp) {
              {{item.equip[0].bad_hp}} ->
            }{{item.equip[0].good_hp   ?  item.equip[0].good_hp   : 0}}</td>
            <td style="width:25%;">{{a25service.stats['agi'][language]}}</td>
            <td style="width:25%;">@if (item.equip[0].bad_spd) {
              {{item.equip[0].bad_spd}} ->
            }{{item.equip[0].good_spd  ?  item.equip[0].good_spd  : 0}}</td>
          </tr>
          <tr>
            <td style="width:25%;">{{a25service.stats['patk'][language]}} </td>
            <td style="width:25%;">@if (item.equip[0].bad_patk) {
              {{item.equip[0].bad_patk}} ->
            }{{item.equip[0].good_patk ? item.equip[0].good_patk : 0}}</td>
            <td style="width:25%;">{{a25service.stats['pdef'][language]}}</td>
            <td style="width:25%;">@if (item.equip[0].bad_pdef) {
              {{item.equip[0].bad_pdef}} ->
            }{{item.equip[0].good_pdef ? item.equip[0].good_pdef : 0}}</td>
          </tr>
          <tr>
            <td style="width:25%;">{{a25service.stats['matk'][language]}} </td>
            <td style="width:25%;">@if (item.equip[0].bad_matk) {
              {{item.equip[0].bad_matk}} ->
            }{{item.equip[0].good_matk ? item.equip[0].good_matk : 0}}</td>
            <td style="width:25%;">{{a25service.stats['mdef'][language]}}</td>
            <td style="width:25%;">@if (item.equip[0].bad_mdef) {
              {{item.equip[0].bad_mdef}} ->
            }{{item.equip[0].good_mdef ? item.equip[0].good_mdef : 0}}</td>
          </tr>
        </tbody></table>
      }
      @if (item.recipe) {
        <table class="tbl"><tbody>
          <tr class="table-dark-center"><th>Ingredients</th></tr>
          <tr>
            <td>
              <ul>
                @for (i of item.recipe[0].ing; track i) {
                  <li>
                    <a routerLink="/{{gameURL}}/items/materials/{{i[1]}}/{{language}}">{{i[2]}}</a> x{{i[0]}}
                  </li>
                }
              </ul>
            </td>
          </tr>
          <tr class="table-dark-center"><th>Unlock Condition</th></tr>
          <tr>
            <td>
              <ul>
                @for (i of item.recipe[0].unlocks; track i) {
                  <li>
                    {{i}}
                  </li>
                }
              </ul>
            </td>
          </tr>
        </tbody></table>
      }
    </div>
    @if (showNav) {
      <div class="col-md-3" ></div>
    }
  </div>
}